<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Element Color Script</title>
</head>
<body>
        <!-- Container where the script will inject the processed SVG -->
        <div id="svg-container">
            <p id="loading-text">Loading SVG...</p>
        </div>

    <script>
        // --- 1. The Core Logic ---

        /**
         * Fetches an SVG, processes it by coloring elements based on a regex ID pattern,
         * and injects the result into a specified container.
         * * @param {string} url - The URL (or Data URI) of the SVG file to load.
         * @param {string} containerId - The ID of the HTML element to hold the resulting SVG.
         */
        async function loadAndColorSVG(url, containerId) {
            const container = document.getElementById(containerId);
            const loadingText = document.getElementById('loading-text');

            try {
                // Fetch the SVG file content
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const svgText = await response.text();

                // Parse the text into a DOM structure
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgText, "image/svg+xml");
                const svgElement = svgDoc.querySelector("svg");

                if (!svgElement) {
                    throw new Error("Could not find SVG root element in the parsed document.");
                }

                const allElements = svgElement.querySelectorAll('*');
                // Define the Regex: matches 'id' followed by 8 hex chars and an underscore
                const idRegex = /^id[0-9a-f]{8}_/;

                allElements.forEach(el => {
                  // Skip the coloring if the element is the root SVG element itself
                  if (el === svgElement) {return;}

                  const id = el.getAttribute('id');
                  el.setAttribute('class', ''); // reset class
                  if (id) {el.setAttribute('stroke', idRegex.test(id) ? 'red' : 'black');}
                  if (id) {el.setAttribute('fill',   idRegex.test(id) ? 'red' : 'black');}
                  if (id) {el.setAttribute('color',  idRegex.test(id) ? 'red' : 'black');}
                });

                // Clear the loading text and append the modified SVG to the container
                if(loadingText) loadingText.remove();
                container.appendChild(svgElement);

            } catch (error) {
                console.error("Error loading or processing SVG:", error);
                if(loadingText) loadingText.textContent = `Error: ${error.message}. Check console for details.`;
                container.classList.add('border-red-500');
            }
        }

        // Execute the function on page load
        window.onload = () => {
            loadAndColorSVG("../svg/PowSyBl-SLD-2substations-KRISTIANSAND-and-ARENDAL.svg", 'svg-container');
        };

    </script>
</body>
</html>
